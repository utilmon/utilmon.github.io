<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Portfolio Optimization with QC | Jay Bae </title> <meta name="author" content="Jay Bae"> <meta name="description" content="Portfolio Optimization walkthrough with qiskit"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%90%B1%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://utilmon.github.io/blog/2024/portfolio-optimization/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Jay</span> Bae </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Portfolio Optimization with QC</h1> <p class="post-meta"> Created on May 15, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/physics"> <i class="fa-solid fa-hashtag fa-sm"></i> physics</a>   <a href="/blog/tag/programming"> <i class="fa-solid fa-hashtag fa-sm"></i> programming</a>   <a href="/blog/tag/code"> <i class="fa-solid fa-hashtag fa-sm"></i> code</a>   ·   <a href="/blog/category/quantum-computing"> <i class="fa-solid fa-tag fa-sm"></i> Quantum-Computing</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <h1 id="optimizing-your-portfolio-with-quantum-computers">Optimizing your portfolio with quantum computers</h1> <h2 id="introduction-what-is-portfolio-optimization">Introduction: What is portfolio optimization?</h2> <p>Portfolio optimization is a crucial process for anyone who wants to maximize returns from their investments. Investments are usually a collection of so-called assets (stock, credits, bonds, derivatives, calls, puts, etc..) and this collection of assets is called a <strong>portfolio</strong>.</p> <p>The goal of portfolio optimization is to minimize risks (financial loss) and maximize returns (financial gain). But this process is not as simple as it may seem. Gaining high returns with little risk is indeed too good to be true. Risks and returns usually have a trade-off relationship which makes optmizing your portfolio a little more complicated. As Dr. Harry Markowitz states in his Modern Portfolio Theory he created in 1952, “risk is an inherrent part of higher reward.”</p> <p><strong>Modern Portfolio Theory (MPT)</strong> <br> An investment theory based on the idea that investors are risk-averse, meaning that when given two portfolios that offer the same expected return they will prefer the less risky one. Investors can construct portfolios to maximize expected return based on a given level of market risk, emphasizing that risk is an inherent part of higher reward. It is one of the most important and influential economic theories dealing with finance and investment. Dr. Harry Markowitz created the modern portfolio theory (MPT) in 1952 and won the Nobel Prize in Economic Sciences in 1990 for it. <br><br> <strong>Reference:</strong> <a href="https://en.wikipedia.org/wiki/Modern_portfolio_theory" rel="external nofollow noopener" target="_blank">Modern Portfolio Theory</a></p> <h2 id="1-finding-the-efficient-frontier">1. Finding the efficient frontier</h2> <p>The Modern portfolio theory (MPT) serves as a general framework to determine an ideal portfolio for investors. The MPT is also referred to as mean-variance portfolio theory because it assumes that any investor will choose the optimal portfolio from the set of portfolios that</p> <ul> <li>Maximizes expected return for a given level of risk; and</li> <li>Minimizes risks for a given level of expected returns.</li> </ul> <p>Consider a situation where you have two stocks to choose from: A and B. You can invest your entire wealth in one of these two stocks. Or you can invest 10% in A and 90% in B, or 20% in A and 80% in B, or 70% in A and 30% in B, etc … There is a huge number of possible combinations and this is a simple case when considering two stocks. Imagine the different combinations you have to consider when you have thousands of stocks.</p> <p>The minimum variance frontier shows the minimum variance that can be achieved for a given level of expected return. To construct a minimum-variance frontier of a portfolio:</p> <ul> <li>Use historical data to estimate the mean, variance of each individual stock in the portfolio, and the correlation of each pair of stocks.</li> <li>Use a computer program to find out the weights of all stocks that minimize the portfolio variance for each pre-specified expected return.</li> <li>Calculate the expected returns and variances for all the minimum variance portfolios determined in step 2 and then graph the two variables.</li> </ul> <p>Investors will never want to hold a portfolio below the minimum variance point. They will always get higher returns along the positively sloped part of the minimum-variance frontier. And the positively sloped part of the minimum-variance frontier is called the <strong>efficient frontier</strong>.</p> <p>The <strong>efficient frontier</strong> is where the optimal portfolios are. And it helps narrow down the different portfolios from which the investor may choose.</p> <h2 id="2-goal-of-our-exercise">2. Goal Of Our Exercise</h2> <p>The goal of this exercise is to find the efficent frontier for an inherent risk using a quantum approach. We will use Qiskit’s Finance application modules to convert our portfolio optimization problem into a quadratic program so we can then use variational quantum algorithms such as VQE and QAOA to solve our optimization problem. Let’s first start by looking at the actual problem we have at hand.</p> <h2 id="3-four-stock-portfolio-optimization-problem">3. Four-Stock Portfolio Optimization Problem</h2> <p>Let us consider a portfolio optimization problem where you have a total of four assets (e.g. STOCK0, STOCK1, STOCK2, STOCK3) to choose from. Your goal is to find out a combination of two assets that will minimize the tradeoff between risk and return which is the same as finding the efficient frontier for the given risk.</p> <h2 id="4-formulation">4. Formulation</h2> <p>How can we formulate this problem?<br> The function which describes the efficient frontier can be formulated into a quadratic program with linear constraints as shown below. <br> The terms that are marked in red are associated with risks and the terms in blue are associated with returns. You can see that our goal is to minimize the tradeoff between risk and return. In general, the function we want to optimize is called an objective function. <br> <br></p> \[\min_{x \in \{0, 1\}^n}: q x^n\Sigma x - \mu ^n x\] \[subject \ to: 1^n x = B\] <ul> <li> <font size="4em">x</font> <p>indicates asset allocation.</p> </li> <li> <font size="4em">Σ</font> <p>(sigma) is a covariance matrix. A covariance matrix is a useful math concept that is widely applied in financial engineering. It is a statistical measure of how two asset prices are varying with respect to each other. When the covariance between two stocks is high, it means that one stock experiences heavy price movements and is volatile if the price of the other stock changes.</p> </li> <li> <font size="4em">q</font> <p>is called a risk factor (risk tolerance), which is an evaluation of an individual’s willingness or ability to take risks. For example, when you use the automated financial advising services, the so-called robo-advising, you will usually see different risk tolerance levels. This q value is the same as such and takes a value between 0 and 1.</p> </li> <li> <font size="4em">𝝁</font> <p>(mu) is the expected return and is something we obviously want to maximize.</p> </li> <li> <font size="4em">n</font> <p>is the number of different assets we can choose from</p> </li> <li> <font size="4em">B</font> <p>stands for Budget. And budget in this context means the number of assets we can allocate in our portfolio.</p> </li> </ul> <h4 id="goal">Goal:</h4> <p>Our goal is to find the <strong>x</strong> value. The x value here indicates which asset to pick (𝑥[𝑖]=1) and which not to pick (𝑥[𝑖]=0).</p> <h4 id="assumptions">Assumptions:</h4> <p>We assume the following simplifications:</p> <ul> <li>all assets have the same price (normalized to 1),</li> <li>the full budget \(B\) has to be spent, i.e. one has to select exactly \(B\) assets.</li> <li>the equality constraint \(1^n x = B\) is mapped to a penalty term \((1^n x - B)^2\) which is scaled by a parameter and subtracted from the objective function.</li> </ul> <h2 id="step-1-import-necessary-libraries">Step 1. Import necessary libraries</h2> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Let us begin by importing necessary libraries.
</span><span class="kn">from</span> <span class="n">qiskit</span> <span class="kn">import</span> <span class="n">Aer</span>
<span class="kn">from</span> <span class="n">qiskit.algorithms</span> <span class="kn">import</span> <span class="n">VQE</span><span class="p">,</span> <span class="n">QAOA</span><span class="p">,</span> <span class="n">NumPyMinimumEigensolver</span>
<span class="kn">from</span> <span class="n">qiskit.algorithms.optimizers</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="n">qiskit.circuit.library</span> <span class="kn">import</span> <span class="n">TwoLocal</span>
<span class="kn">from</span> <span class="n">qiskit.utils</span> <span class="kn">import</span> <span class="n">QuantumInstance</span>
<span class="kn">from</span> <span class="n">qiskit.utils</span> <span class="kn">import</span> <span class="n">algorithm_globals</span>
<span class="kn">from</span> <span class="n">qiskit_finance</span> <span class="kn">import</span> <span class="n">QiskitFinanceError</span>
<span class="kn">from</span> <span class="n">qiskit_finance.applications.optimization</span> <span class="kn">import</span> <span class="n">PortfolioOptimization</span>
<span class="kn">from</span> <span class="n">qiskit_finance.data_providers</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="n">qiskit_optimization.algorithms</span> <span class="kn">import</span> <span class="n">MinimumEigenOptimizer</span>
<span class="kn">from</span> <span class="n">qiskit_optimization.applications</span> <span class="kn">import</span> <span class="n">OptimizationApplication</span>
<span class="kn">from</span> <span class="n">qiskit_optimization.converters</span> <span class="kn">import</span> <span class="n">QuadraticProgramToQubo</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="n">warnings</span>
<span class="kn">from</span> <span class="n">sympy.utilities.exceptions</span> <span class="kn">import</span> <span class="n">SymPyDeprecationWarning</span>
<span class="n">warnings</span><span class="p">.</span><span class="nf">simplefilter</span><span class="p">(</span><span class="sh">"</span><span class="s">ignore</span><span class="sh">"</span><span class="p">,</span> <span class="n">SymPyDeprecationWarning</span><span class="p">)</span>
</code></pre></div></div> <h2 id="step-2-generate-time-series-data-financial-data">Step 2. Generate time series data (Financial Data)</h2> <p>Let’s first generate a random time series financial data for a total number of stocks n=4. We use RandomDataProvider for this. We are going back in time and retrieve financial data from November 5, 1955 to October 26, 1985.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Set parameters for assets and risk factor
</span><span class="n">num_assets</span> <span class="o">=</span> <span class="mi">4</span>     <span class="c1"># set number of assets to 4
</span><span class="n">q</span> <span class="o">=</span> <span class="mf">0.5</span>                   <span class="c1"># set risk factor to 0.5
</span><span class="n">budget</span> <span class="o">=</span> <span class="mi">2</span>           <span class="c1"># set budget as defined in the problem
</span><span class="n">seed</span> <span class="o">=</span> <span class="mi">132</span>     <span class="c1">#set random seed
</span>
<span class="c1"># Generate time series data
</span><span class="n">stocks</span> <span class="o">=</span> <span class="p">[(</span><span class="sh">"</span><span class="s">STOCK%s</span><span class="sh">"</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">num_assets</span><span class="p">)]</span>
<span class="n">data</span> <span class="o">=</span> <span class="nc">RandomDataProvider</span><span class="p">(</span><span class="n">tickers</span><span class="o">=</span><span class="n">stocks</span><span class="p">,</span>
                 <span class="n">start</span><span class="o">=</span><span class="n">datetime</span><span class="p">.</span><span class="nf">datetime</span><span class="p">(</span><span class="mi">1955</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>
                 <span class="n">end</span><span class="o">=</span><span class="n">datetime</span><span class="p">.</span><span class="nf">datetime</span><span class="p">(</span><span class="mi">1985</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">26</span><span class="p">),</span>
                 <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">data</span><span class="p">.</span><span class="nf">run</span><span class="p">()</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Let's plot our finanical data
</span><span class="nf">for </span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">_tickers</span><span class="p">):</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">_data</span><span class="p">[</span><span class="n">cnt</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">days</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">stock value</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div> <h2 id="step-3-quadratic-program-formulation">Step 3. Quadratic Program Formulation</h2> <p>Let’s generate the expected return first and then the covariance matrix which are both needed to create our portfolio.</p> <h3 id="expected-return-μ">Expected Return μ</h3> <p>Expected return of a portfolio is the anticipated amount of returns that a portfolio may generate, making it the mean (average) of the portfolio’s possible return distribution. For example, let’s say stock A, B and C each weighted 50%, 20% and 30% respectively in the portfolio. If the expected return for each stock was 15%, 6% and 9% respectively, the expected return of the portfolio would be:</p> <div align="center"> μ = (50% x 15%) + (20% x 6%) + (30% x 9%) = 11.4% </div> <p>For the problem data we generated earlier, we can calculate the expected return over the 30 years period from 1955 to 1985 by using the following <code class="language-plaintext highlighter-rouge">get_period_return_mean_vector()</code> method which is provided by Qiskit’s RandomDataProvider.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Let's calculate the expected return for our problem data
</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">get_period_return_mean_vector</span><span class="p">()</span>   <span class="c1"># Returns a vector containing the mean value of each asset's expected return.
</span>
<span class="nf">print</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
</code></pre></div></div> <h3 id="covariance-matrix-σ">Covariance Matrix Σ</h3> <p>Covariance Σ is a statistical measure of how two asset’s mean returns vary with respect to each other and helps us understand the amount of risk involved from an investment portfolio’s perspective to make an informed decision about buying or selling stocks.</p> <p>If you have ‘n’ stocks in your porfolio, the size of the covariance matrix will be n x n. Let us plot the covariance marix for our 4 stock portfolio which will be a 4 x 4 matrix.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Let's plot our covariance matrix Σ（sigma）
</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">get_period_return_covariance_matrix</span><span class="p">()</span> <span class="c1">#Returns the covariance matrix of the four assets
</span><span class="nf">print</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">x_label_list</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">stock3</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">stock2</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">stock1</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">stock0</span><span class="sh">'</span><span class="p">]</span>
<span class="n">y_label_list</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">stock3</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">stock2</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">stock1</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">stock0</span><span class="sh">'</span><span class="p">]</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_xticks</span><span class="p">([</span><span class="o">-</span><span class="mf">0.75</span><span class="p">,</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.75</span><span class="p">])</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_yticks</span><span class="p">([</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span><span class="o">-</span><span class="mf">0.75</span><span class="p">])</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_xticklabels</span><span class="p">(</span><span class="n">x_label_list</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_yticklabels</span><span class="p">(</span><span class="n">y_label_list</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">clim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.000002</span><span class="p">,</span> <span class="mf">0.00001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div> <p>The left-to-right diagnoal values (yellow boxes in the figure below) show the relation of a stock with ‘itself’. And the off-diagonal values show the deviation of each stock’s mean expected return with respect to each other. A simple way to look at a covariance matrix is:</p> <ul> <li>If two stocks increase and decrease simultaneously then the covariance value will be positive.</li> <li>If one increases while the other decreases then the covariance will be negative.</li> </ul> <p>You may have heard the phrase “Don’t Put All Your Eggs in One Basket.” If you invest in things that always move in the same direction, there will be a risk of losing all your money at the same time. Covariance matrix is a nice measure to help investors diversify their assets to reduce such risk.</p> <p>Now that we have all the values we need to build our portfolio for optimization, we will look into Qiskit’s Finance application class that will help us contruct the quadratic program for our problem.</p> <h2 id="qiskit-finance-application-class">Qiskit Finance application class</h2> <p>In Qiskit, there is a dedicated <a href="https://qiskit.org/documentation/finance/stubs/qiskit_finance.applications.PortfolioOptimization.html#qiskit_finance.applications.PortfolioOptimization" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">PortfolioOptimization</code></a> application to construct the quadratic program for portfolio optimizations.</p> <p>PortfolioOptimization class creates a porfolio instance by taking the following <strong>five arguments</strong> then converts the instance into a quadratic program.</p> <p>Arguments of the PortfolioOptimization class:</p> <ul> <li>expected_returns</li> <li>covariances</li> <li>risk_factor</li> <li>budget</li> <li>bounds</li> </ul> <p>Once our portfolio instance is converted into a quadratic program, then we can use quantum variational algorithms suchs as Variational Quantum Eigensolver (VQE) or the Quantum Approximate Optimization Algorithm (QAOA) to find the optimal solution to our problem.<br></p> <p>We already obtained expected_return and covariances from Step 3 and have risk factor and budget pre-defined. So, let’s build our portfolio using the <a href="https://qiskit.org/documentation/finance/stubs/qiskit_finance.applications.PortfolioOptimization.html#qiskit_finance.applications.PortfolioOptimization" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">PortfolioOptimization</code></a> class.</p> <h2 id="step-3-create-the-portfolio-instance-using-portfoliooptimization-class">Step 3: Create the portfolio instance using PortfolioOptimization class</h2> <p>To generate the portfolio instance using the PortfolioOptimization class, we simply pass in the five arguments and their values obtained in the previous steps:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">portfolio</span> <span class="o">=</span> <span class="nc">PortfolioOptimization</span><span class="p">(</span>
    <span class="n">expected_returns</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span>
    <span class="n">covariances</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span>
    <span class="n">risk_factor</span><span class="o">=</span><span class="n">q</span><span class="p">,</span>
    <span class="n">budget</span><span class="o">=</span><span class="n">budget</span><span class="p">,</span>
    <span class="n">bounds</span><span class="o">=</span><span class="bp">None</span>
<span class="p">)</span>
<span class="n">qp</span> <span class="o">=</span> <span class="n">portfolio</span><span class="p">.</span><span class="nf">to_quadratic_program</span><span class="p">()</span>
</code></pre></div></div> <p>This converts the portfolio instance into a quadratic program <code class="language-plaintext highlighter-rouge">qp</code> that we can then solve using variational quantum algorithms.</p> <h2 id="step-5-solve-with-classical-optimizer-as-a-reference">Step 5. Solve with classical optimizer as a reference</h2> <p>Lets solve the problem. First classically…</p> <p>We can now use the Operator we built above without regard to the specifics of how it was created. We set the algorithm for the NumPyMinimumEigensolver so we can have a classical reference. Backend is not required since this is computed classically not using quantum computation. The result is returned as a dictionary.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">exact_mes</span> <span class="o">=</span> <span class="nc">NumPyMinimumEigensolver</span><span class="p">()</span>
<span class="n">exact_eigensolver</span> <span class="o">=</span> <span class="nc">MinimumEigenOptimizer</span><span class="p">(</span><span class="n">exact_mes</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">exact_eigensolver</span><span class="p">.</span><span class="nf">solve</span><span class="p">(</span><span class="n">qp</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div> <p>The optimal value indicates your asset allocation.</p> <h2 id="solution-using-vqe">Solution using VQE</h2> <p><strong>Variational Quantum Eigensolver (VQE)</strong> is a classical-quantum hybrid algorithm which outsources some of the processing workload to a classical computer to efficiently calculate the ground state energy (lowest energy) of a <a href="https://en.wikipedia.org/wiki/Hamiltonian_(quantum_mechanics)" rel="external nofollow noopener" target="_blank"><strong>Hamiltonian</strong></a>. As we discussed earlier, we can reformulate the quadratic program as a ground state energy search to be solved by <strong>VQE</strong> where the ground state corresponds to the optimal solution we are looking for.</p> <p>Here is an example implementation of VQE using the two-local circuit. The two-local circuit is a parameterized circuit consisting of alternating rotation layers and entanglement layers. The rotation layers are single qubit gates applied on all qubits. The entanglement layer uses two-qubit gates to entangle the qubits. Here, we use Ry gates (i.e. ‘ry’) for the rotational blocks and controlled-Z gates (i.e. ‘cz’) for the entanglement blocks in our parameterized circuit.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">optimizer</span> <span class="o">=</span> <span class="nc">SLSQP</span><span class="p">(</span><span class="n">maxiter</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">algorithm_globals</span><span class="p">.</span><span class="n">random_seed</span> <span class="o">=</span> <span class="mi">1234</span>
<span class="n">backend</span> <span class="o">=</span> <span class="n">Aer</span><span class="p">.</span><span class="nf">get_backend</span><span class="p">(</span><span class="sh">'</span><span class="s">statevector_simulator</span><span class="sh">'</span><span class="p">)</span>

<span class="n">ry</span> <span class="o">=</span> <span class="nc">TwoLocal</span><span class="p">(</span><span class="n">num_assets</span><span class="p">,</span> <span class="sh">'</span><span class="s">ry</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">cz</span><span class="sh">'</span><span class="p">,</span> <span class="n">reps</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">entanglement</span><span class="o">=</span><span class="sh">'</span><span class="s">full</span><span class="sh">'</span><span class="p">)</span>
<span class="n">quantum_instance</span> <span class="o">=</span> <span class="nc">QuantumInstance</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span> <span class="n">seed_simulator</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">seed_transpiler</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">vqe</span> <span class="o">=</span> <span class="nc">VQE</span><span class="p">(</span><span class="n">ry</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">quantum_instance</span><span class="o">=</span><span class="n">quantum_instance</span><span class="p">)</span>

<span class="n">vqe_meo</span> <span class="o">=</span> <span class="nc">MinimumEigenOptimizer</span><span class="p">(</span><span class="n">vqe</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">vqe_meo</span><span class="p">.</span><span class="nf">solve</span><span class="p">(</span><span class="n">qp</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div> <p>VQE should give you the same optimal results as the reference solution.</p> <h2 id="portfolio-optimization-for-b3-n4-stocks">Portfolio optimization for B=3, n=4 stocks</h2> <p>Now let’s consider solving the same problem where one can allocate double weights (can allocate twice the amount) for a single asset. For example, if you allocate twice for STOCK3 and one for STOCK2, then your portfolio can be represented as [2, 1, 0, 0]. If you allocate a single weight for STOCK0, STOCK1, STOCK2 then your portfolio will look like [0, 1, 1, 1].</p> <p>Furthermore, let’s change the constraint to B=3. With this new constraint, find the optimal portfolio that minimizes the tradeoff between risk and return.</p> <p>There are two approaches we can take to handle the double weights:</p> <ol> <li>Use the <code class="language-plaintext highlighter-rouge">bounds</code> option in the PortfolioOptimization class to allow integer variables. By default, bounds is set to ‘None’ which means all the variables are binary. But we can set bounds=[[0,2],[0,2],[0,2],[0,2]] to allow any one of the four stocks to have double weights.</li> <li>Repeat the stocks twice in the list and concatenate the expected return and covariance data. For example, you can allocate double weights to one asset by repeating them twice like [STOCKA, STOCKB, STOCKC, STOCKD, <strong>STOCKA</strong>, <strong>STOCKB</strong>, <strong>STOCKC</strong>, <strong>STOCKD</strong>]. This way, even with only binary variables, you can still allocate double weights. You would just need to double the number of assets and concatenate mu and sigma accordingly.</li> </ol> <p>Here is the code using the first approach with the <code class="language-plaintext highlighter-rouge">bounds</code> option:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">q2</span> <span class="o">=</span> <span class="mf">0.5</span>     <span class="c1">#Set risk factor to 0.5
</span><span class="n">budget2</span> <span class="o">=</span> <span class="mi">3</span>      <span class="c1">#Set budget to 3
</span>
<span class="n">portfolio2</span> <span class="o">=</span> <span class="nc">PortfolioOptimization</span><span class="p">(</span><span class="n">expected_returns</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span> <span class="n">covariances</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">risk_factor</span><span class="o">=</span><span class="n">q2</span><span class="p">,</span> <span class="n">budget</span><span class="o">=</span><span class="n">budget2</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]])</span>
<span class="n">qp2</span> <span class="o">=</span> <span class="n">portfolio2</span><span class="p">.</span><span class="nf">to_quadratic_program</span><span class="p">()</span>
</code></pre></div></div> <h2 id="solution-using-qaoa">Solution using QAOA</h2> <p><strong>Quantum Approximate Optimization Algorithm (QAOA)</strong> is another variational algorithm that has applications for solving combinatorial optimization problems on near-term quantum systems. This algorithm can also be used to calculate ground states of a Hamiltonian and can be easily implemented by using Qiskit’s <strong>QAOA</strong> application.</p> <p>Let’s solve the B=3 problem using QAOA:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">optimizer</span> <span class="o">=</span> <span class="nc">SLSQP</span><span class="p">(</span><span class="n">maxiter</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">algorithm_globals</span><span class="p">.</span><span class="n">random_seed</span> <span class="o">=</span> <span class="mi">1234</span>
<span class="n">backend</span> <span class="o">=</span> <span class="n">Aer</span><span class="p">.</span><span class="nf">get_backend</span><span class="p">(</span><span class="sh">'</span><span class="s">statevector_simulator</span><span class="sh">'</span><span class="p">)</span>

<span class="n">quantum_instance</span> <span class="o">=</span> <span class="nc">QuantumInstance</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span> <span class="n">seed_simulator</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">seed_transpiler</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">qaoa</span> <span class="o">=</span> <span class="nc">QAOA</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">reps</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">quantum_instance</span><span class="o">=</span><span class="n">quantum_instance</span><span class="p">)</span>
<span class="n">meo</span> <span class="o">=</span> <span class="nc">MinimumEigenOptimizer</span><span class="p">(</span><span class="n">qaoa</span><span class="p">)</span>

<span class="n">qaoa_meo</span> <span class="o">=</span> <span class="nc">MinimumEigenOptimizer</span><span class="p">(</span><span class="n">qaoa</span><span class="p">)</span>

<span class="n">result2</span> <span class="o">=</span> <span class="n">qaoa_meo</span><span class="p">.</span><span class="nf">solve</span><span class="p">(</span><span class="n">qp2</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">result2</span><span class="p">)</span>
</code></pre></div></div> <p>The QAOA execution may take a few minutes to complete.</p> <h3 id="further-reading">Further Reading:</h3> <p>If you are interested in further reading, here are a few resources to explore: <br></p> <ol> <li> <a href="https://arxiv.org/abs/1710.01022" rel="external nofollow noopener" target="_blank"><strong>Quantum optimization using variational algorithms on near-term quantum devices. Moll et al. 2017</strong></a><br> </li> <li> <a href="https://arxiv.org/abs/1907.04769" rel="external nofollow noopener" target="_blank"><strong>Improving Variational Quantum Optimization using CVaR. Barkoutsos et al. 2019.</strong></a><br> </li> </ol> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="https://blog.google/technology/ai/google-gemini-update-flash-ai-assistant-io-2024/" target="_blank" rel="external nofollow noopener">Google Gemini updates: Flash 1.5, Gemma 2 and Project Astra</a> <svg width="1rem" height="1rem" viewbox="0 0 30 30" xmlns="http://www.w3.org/2000/svg"> <path d="M17 13.5v6H5v-12h6m3-3h6v6m0-6-9 9" class="icon_svg-stroke" stroke="#999" stroke-width="1.5" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path> </svg> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="https://medium.com/@al-folio/displaying-external-posts-on-your-al-folio-blog-b60a1d241a0a?source=rss-17feae71c3c4------2" target="_blank" rel="external nofollow noopener">Displaying External Posts on Your al-folio Blog</a> <svg width="1rem" height="1rem" viewbox="0 0 30 30" xmlns="http://www.w3.org/2000/svg"> <path d="M17 13.5v6H5v-12h6m3-3h6v6m0-6-9 9" class="icon_svg-stroke" stroke="#999" stroke-width="1.5" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path> </svg> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/plotly/">a post with plotly.js</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/photo-gallery/">a post with image galleries</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/cannes-2024/">Cannes 2024 poster</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Jay Bae. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>